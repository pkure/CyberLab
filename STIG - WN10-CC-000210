WN10-CC-000210 – Windows Defender SmartScreen for Explorer Must Be Enabled
Overview

Windows Defender SmartScreen helps protect users by checking files and URLs accessed through File Explorer against Microsoft’s reputation services. If disabled, malicious content may execute without warning.

STIG Requirement

WN10-CC-000210: The Windows Defender SmartScreen for Explorer must be enabled.

Severity: Medium

Discussion: SmartScreen filters downloads and untrusted files. Setting it to “Block” ensures suspicious or malicious files cannot be run without explicit admin override.

Fix Text

Configure the policy:

Navigate in Group Policy:
Computer Configuration > Administrative Templates > Windows Components > File Explorer > Configure Windows Defender SmartScreen

Set to: Enabled → “Warn and prevent bypass” (STIG baseline = "Block").

Registry equivalents:

Key:   HKLM\SOFTWARE\Policies\Microsoft\Windows\System
Values:
  EnableSmartScreen (DWORD)     = 1
  ShellSmartScreenLevel (REG_SZ) = Block

Manual Registry Fix
# Enable SmartScreen + block untrusted files
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /t REG_SZ /d Block /f

# Verify
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel


Rollback (not recommended – disables SmartScreen):

reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 0 /f
reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /f

PowerShell Script (Check / Remediate / Rollback)

Save as Set-WN10-CC-000210.ps1


__________________________________________________________________


<#
.SYNOPSIS
  Enforce DISA STIG WN10-CC-000210 (Windows Defender SmartScreen for Explorer must be enabled).

.DESCRIPTION
  Ensures EnableSmartScreen = 1 and ShellSmartScreenLevel = "Block"
  under HKLM:\SOFTWARE\Policies\Microsoft\Windows\System.
  Creates a backup before changes for rollback.

.NOTES
  Author          : Peter Kure
  LinkedIn        : linkedin.com/in/peter-kure
  Github          : github.com/pkure
  Date Created    : 8/28/2025
  Last Modified   : 8/28/2025
  Version         : 2.1
  CVEs            : n/a
  Plugin IDs      : n/a
  STIG-ID         : WN10-CC-000210

.PARAMETER Action
  "Check"     - Display current settings
  "Remediate" - Apply STIG-compliant values
  "Rollback"  - Restore from backup if available

.EXAMPLE
  .\Set-WN10-CC-000210.ps1 -Action Check
#>

param(
    [Parameter(Mandatory=$true)]
    [ValidateSet("Check","Remediate","Rollback")]
    [string]$Action
)

$RegPath   = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System"
$BackupKey = "HKLM:\SOFTWARE\LogNPacific\STIGBackups\WN10-CC-000210"

switch ($Action) {
    "Check" {
        $smartScreen = Get-ItemProperty -Path $RegPath -Name "EnableSmartScreen" -ErrorAction SilentlyContinue
        $level = Get-ItemProperty -Path $RegPath -Name "ShellSmartScreenLevel" -ErrorAction SilentlyContinue

        if ($null -eq $smartScreen) {
            Write-Output "EnableSmartScreen not set."
        } else {
            Write-Output "EnableSmartScreen is set to $($smartScreen.EnableSmartScreen)"
        }

        if ($null -eq $level) {
            Write-Output "ShellSmartScreenLevel not set."
        } else {
            Write-Output "ShellSmartScreenLevel is set to $($level.ShellSmartScreenLevel)"
        }
    }

    "Remediate" {
        if (-not (Test-Path $RegPath)) {
            New-Item -Path (Split-Path $RegPath) -Name (Split-Path $RegPath -Leaf) -Force | Out-Null
        }

        # Backup existing values
        foreach ($val in @("EnableSmartScreen","ShellSmartScreenLevel")) {
            $current = Get-ItemProperty -Path $RegPath -Name $val -ErrorAction SilentlyContinue
            if ($current) {
                New-Item -Path $BackupKey -Force | Out-Null
                New-ItemProperty -Path $BackupKey -Name $val -Value $current.$val -PropertyType String -Force | Out-Null
                Write-Output "Backup saved: $BackupKey\$val = $($current.$val)"
            }
        }

        # Apply compliant settings
        New-ItemProperty -Path $RegPath -Name "EnableSmartScreen" -Value 1 -PropertyType DWORD -Force | Out-Null
        Write-Output "Remediation applied: EnableSmartScreen set to 1"

        New-ItemProperty -Path $RegPath -Name "ShellSmartScreenLevel" -Value "Block" -PropertyType String -Force | Out-Null
        Write-Output "Remediation applied: ShellSmartScreenLevel set to Block"
    }

    "Rollback" {
        if (-not (Test-Path $RegPath)) {
            New-Item -Path (Split-Path $RegPath) -Name (Split-Path $RegPath -Leaf) -Force | Out-Null
        }

        foreach ($val in @("EnableSmartScreen","ShellSmartScreenLevel")) {
            $backup = Get-ItemProperty -Path $BackupKey -Name $val -ErrorAction SilentlyContinue
            if ($backup) {
                New-ItemProperty -Path $RegPath -Name $val -Value $backup.$val -PropertyType String -Force | Out-Null
                Write-Output "Rolled back: $val restored to $($backup.$val)"
            } else {
                Write-Output "No backup found for $val rollback."
            }
        }
    }
}


__________________________________________________________________

Example Usage

Check current settings

.\Set-WN10-CC-000210.ps1 -Action Check


Remediate (enable SmartScreen + Block untrusted)

.\Set-WN10-CC-000210.ps1 -Action Remediate


Rollback

.\Set-WN10-CC-000210.ps1 -Action Rollback

One-Liner PowerShell Commands

Check

reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel


Remediate

reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /t REG_SZ /d Block /f


Rollback

reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 0 /f
reg delete "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /f
