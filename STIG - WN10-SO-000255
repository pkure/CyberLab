WN10-SO-000255 â€“ UAC Must Automatically Deny Elevation Requests for Standard Users
Overview

This setting ensures that standard user accounts cannot bypass User Account Control (UAC) prompts by attempting to elevate privileges. If set insecurely, a standard user might be prompted to enter administrator credentials, potentially exposing privileged credentials or weakening least privilege.

STIG Requirement

WN10-SO-000255: User Account Control must automatically deny elevation requests for standard users.

Severity: Medium

Discussion: By forcing automatic denial, Windows ensures that elevation attempts from standard users are blocked outright, rather than prompting for administrator credentials. This limits attack surface by preventing credential prompts that could be targeted or abused.

Fix:
Configure the policy:

Navigate in Group Policy:
Computer Configuration > Windows Settings > Security Settings > Local Policies > Security Options > User Account Control: Behavior of the elevation prompt for standard users

Set to: Automatically deny elevation requests

Registry equivalent:

Key:   HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
Value: ConsentPromptBehaviorUser (DWORD)
Data:  0

Manual Registry Fix
# Apply fix
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ConsentPromptBehaviorUser /t REG_DWORD /d 0 /f

# Verify
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ConsentPromptBehaviorUser


Rollback (not recommended):

reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v ConsentPromptBehaviorUser /t REG_DWORD /d 1 /f

PowerShell Script (Check / Remediate / Rollback)

Save as Set-WN10-SO-000255.ps1


_______________________________________________________________________

<#
.SYNOPSIS
  Enforce DISA STIG WN10-SO-000255 (UAC must automatically deny elevation requests for standard users).

.DESCRIPTION
  Ensures ConsentPromptBehaviorUser is set to 0 under
  HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System.
  Creates a backup before changes for rollback.

.NOTES
  Author          : Peter Kure
  LinkedIn        : linkedin.com/in/peter-kure
  Github          : github.com/pkure
  Date Created    : 8/25/2025
  Last Modified   : 8/25/2025
  Version         : 1.0
  CVEs            : n/a
  Plugin IDs      : n/a
  STIG-ID         : WN10-SO-000255

#>

param(
    [Parameter(Mandatory=$true)]
    [ValidateSet("Check","Remediate","Rollback")]
    [string]$Action
)

$RegPath  = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System"
$Value    = "ConsentPromptBehaviorUser"
$BackupKey = "HKLM:\SOFTWARE\LogNPacific\STIGBackups\WN10-SO-000255"

switch ($Action) {
    "Check" {
        $current = Get-ItemProperty -Path $RegPath -Name $Value -ErrorAction SilentlyContinue
        if ($null -eq $current) {
            Write-Output "Setting not found. Default may be insecure."
        } else {
            Write-Output "$Value is set to $($current.$Value)"
        }
    }

    "Remediate" {
        $current = Get-ItemProperty -Path $RegPath -Name $Value -ErrorAction SilentlyContinue
        if ($current) {
            New-Item -Path $BackupKey -Force | Out-Null
            New-ItemProperty -Path $BackupKey -Name $Value -Value $current.$Value -PropertyType DWORD -Force | Out-Null
            Write-Output "Backup saved: $BackupKey\$Value = $($current.$Value)"
        }

        New-ItemProperty -Path $RegPath -Name $Value -Value 0 -PropertyType DWORD -Force | Out-Null
        Write-Output "Remediation applied: $Value set to 0"
    }

    "Rollback" {
        $backup = Get-ItemProperty -Path $BackupKey -Name $Value -ErrorAction SilentlyContinue
        if ($backup) {
            New-ItemProperty -Path $RegPath -Name $Value -Value $backup.$Value -PropertyType DWORD -Force | Out-Null
            Write-Output "Rolled back: $Value restored to $($backup.$Value)"
        } else {
            Write-Output "No backup found for rollback."
        }
    }
}


_______________________________________________________________________



One-Liner PowerShell Commands

Check

.\Set-WN10-SO-000255.ps1 -Action Check
Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name ConsentPromptBehaviorUser


Remediate

.\Set-WN10-SO-000255.ps1 -Action Remediate
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name ConsentPromptBehaviorUser -Value 0


Rollback

.\Set-WN10-SO-000255.ps1 -Action Rollback
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name ConsentPromptB
